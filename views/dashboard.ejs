<!-- views/dashboard.ejs -->
<h1 class="mt-4">The Main Page</h1>
<p class="lead mb-3">Welcome <%= user.firstname %> (Role: <%= user.role %>)</p>

<!-- another api -->
<a href="/country">
	<button type="button" class="btn btn-secondary">Go to Country guide page</button>
</a>

<!-- get the random joke -->
<button type="button" class="btn btn-primary" id="liveToastBtn">Get the random joke</button>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
	<div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
		<div class="toast-header">
			<strong class="me-auto">Jokes from Chuck Norris</strong>
			<small id="toastTime"></small>
			<button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
		</div>
		<div class="toast-body" id="toastBody">
			Hello, world! This is a toast message.
		</div>
	</div>
</div>
<!-- Change the link to refer to the admin page -->
<% if (user.role==='admin' ) { %>
	<a href="/admin" class="btn btn-secondary bg-dark text-white">Go to Admin Page</a>
	<% } %>


		<!-- Display Topics for all users -->
		<section class="book_review3">
			<div class="container">
				<div class="row">
					<div class="col-md-12">
						<h1 class="book_info_title" id="programming">Topics</h1>
					</div>
				</div>

				<div class="row">
					<% portfolioItems.forEach(function(item, index) { %>
						<% if (index % 4===0) { %>
				</div>
				<div class="row">
					<% } %>
						<div class="col-md-3 mb-4">
							<div class="card text-bg-dark" onmouseover="showCardDescription(this)"
								onmouseout="hideCardDescription(this)">
								<div style="position: relative;">
									<% if (item.images.length> 1) { %>
										<div class="carousel slide" data-ride="carousel" data-interval="false" id="carousel<%= index %>">
											<div class="carousel-inner">
												<% item.images.forEach(function(image, imgIndex) { %>
													<div class="carousel-item <%= imgIndex === 0 ? 'active' : '' %>">
														<img src="<%= image %>" class="card-img-top" alt="<%= item.name %> Image"
															style="max-width: 400px; max-height: 300px;">
													</div>
													<% }); %>
											</div>
											<a class="carousel-control-prev" href="#carousel<%= index %>" role="button" data-slide="prev">
												<span class="carousel-control-prev-icon" aria-hidden="true"></span>
												<span class="sr-only">Previous</span>
											</a>
											<a class="carousel-control-next" href="#carousel<%= index %>" role="button" data-slide="next">
												<span class="carousel-control-next-icon" aria-hidden="true"></span>
												<span class="sr-only">Next</span>
											</a>
										</div>
										<% } else { %>
											<img src="<%= item.images[0] %>" class="card-img-top" alt="<%= item.name %> Image"
												style="max-width: 400px; max-height: 300px;">
											<% } %>
												<div class="card-text description">
													<p>
														<%= item.description %>
													</p>
												</div>
								</div>
								<div class="card-body">
									<h3 class="card-title">
										<%= item.name %>
									</h3>
									<% if (item.images.length> 1) { %>
										<% } %>
								</div>
							</div>
						</div>
						<% }); %>
				</div>
			</div>
		</section>




		<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
			integrity="sha384-KyZXEAg3QhqLMpG8r+Knujsl5+YoT2zQ8DsjQuaFo3ZG1i+c8FkLToCyuD9Exn0r"
			crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


		<a href="/users/logout" class="btn btn-secondary bg-dark text-white">Logout</a>

		<style>
			.book_info_title {
				margin: 25px 0 25px 0;
			}

			.header {
				border-top: 2px solid #2c7de8;
			}

			.header_inner {
				display: flex;
				justify-content: space-between;
				align-items: center;
				height: 87px;
			}

			.navbar-nav {
				display: flex;
			}

			.navbar-nav li:hover {
				transform: scale(1.2);
			}

			a:hover {
				color: #2c7de8 !important;
			}

			a:active {
				color: #18ffdc !important;
			}

			a {
				color: black;
				text-decoration: none;
				display: inline-block;
			}

			ul {
				list-style: none;
			}

			.navbar-nav li {
				margin-left: 38px;
				transition: all .4s ease-in-out;
			}

			.navbar-nav a {
				font-size: 18px;
				color: black;
				font-weight: 700;
				font-family: 'Phudu', cursive;
			}

			.header_inner_title {
				font-family: 'Roboto', sans-serif;
				font-weight: 900;
				font-size: 40px;
				line-height: 52px;
				text-transform: uppercase;
				color: rgb(0, 0, 0);
			}

			.container {
				max-width: 1170px;
				margin: 0 auto;
				padding: 0 15px;
			}

			.book_inner {
				display: flex;
			}

			.book_review_img_box img {
				position: relative;
				width: 280px;
				height: auto;
				margin-left: 70px;
			}

			.book_name2 {
				color: #ff4834;
			}

			.book_info_text2 {
				font-family: 'Lato', sans-serif;
				color: rgb(0, 0, 0);
				font-weight: 400;
				font-size: 20px;
				max-width: 555px;
				margin-right: 35px;
			}

			.book_info_text3 {
				font-family: 'Lato', sans-serif;
				color: rgb(0, 0, 0);
				font-weight: 400;
				font-size: 20px;
				max-width: 555px;
				margin-right: 35px;
			}

			.book_review2 {
				background-image: url(../img/4060492.jpg);
				background-repeat: no-repeat;
				background-attachment: fixed;
				background-size: cover;
			}

			.card {
				position: relative;
			}

			.card-img-overlay {
				position: absolute;
				bottom: 0;
				left: 0;
				right: 0;
				background-color: rgba(0, 0, 0, 0.5);
				padding: 10px;
				color: white;
			}

			.card-img-top {
				height: 400px;
				object-fit: cover;
				/* Обрезает изображение, если оно не соответствует размеру */
			}

			.card-body {
				height: 100%;
				display: flex;
				flex-direction: column;
			}

			.card-title {
				text-align: center;
			}

			.card-text.description {
				position: absolute;
				bottom: 0;
				background-color: rgba(0, 0, 0, 0.5);
				color: white;
				padding: 10px;
				opacity: 0;
				transition: opacity 0.5s;
			}

			.row-container {
				display: flex;
				align-items: center;
				justify-content: space-between;
				background: #edeef0;
				border-radius: 30px;
				padding-left: 20px;
				margin-bottom: 25px;
			}

			.modal-backdrop.show {
				z-index: 1040;
			}

			.modal.show {
				z-index: 1050;
			}
		</style>

		<script>
			const toastTrigger = document.getElementById('liveToastBtn');
			const toastLiveExample = document.getElementById('liveToast');
			const toastBody = document.getElementById('toastBody');
			const toastTime = document.getElementById('toastTime');

			if (toastTrigger) {
				toastTrigger.addEventListener('click', () => {
					fetch('https://api.chucknorris.io/jokes/random')
						.then(response => response.json())
						.then(data => {
							toastBody.innerText = data.value; // Отображаем шутку в тосте
							const now = new Date();
							toastTime.innerText = now.toLocaleTimeString(); // Обновляем время в тосте
							const toastBootstrap = new bootstrap.Toast(toastLiveExample);
							toastBootstrap.show(); // Показываем тост с шуткой
						})
						.catch(error => {
							console.error('Error:', error);
						});
				});
			}
			function showCardDescription(card) {
				const description = card.querySelector(".description");
				description.style.opacity = "1";
			}

			function hideCardDescription(card) {
				const description = card.querySelector(".description");
				description.style.opacity = "0";
			}
		</script>